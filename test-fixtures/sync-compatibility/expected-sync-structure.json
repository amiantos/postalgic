{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "description": "Expected structure of sync data - both apps should generate data matching this spec",

  "manifest": {
    "requiredFields": ["version", "syncVersion", "lastModified", "appSource", "appVersion", "blogName", "hasDrafts", "files"],
    "optionalFields": ["encryption"],
    "fieldTypes": {
      "version": "string",
      "syncVersion": "number",
      "lastModified": "iso8601-date",
      "appSource": "string",
      "appVersion": "string",
      "blogName": "string",
      "hasDrafts": "boolean",
      "encryption": "object|null",
      "files": "object"
    },
    "encryption": {
      "requiredFields": ["method", "salt", "iterations"],
      "expectedValues": {
        "method": "aes-256-gcm",
        "iterations": 100000
      }
    },
    "fileEntry": {
      "requiredFields": ["hash", "size"],
      "optionalFields": ["modified", "encrypted", "iv"]
    }
  },

  "blog": {
    "requiredFields": ["name", "url", "timezone", "colors"],
    "optionalFields": ["tagline", "authorName", "authorUrl", "authorEmail", "themeIdentifier"],
    "colors": {
      "optionalFields": ["accent", "background", "text", "lightShade", "mediumShade", "darkShade"]
    }
  },

  "category": {
    "requiredFields": ["id", "name", "stub", "createdAt"],
    "optionalFields": ["description"]
  },

  "categoryIndex": {
    "requiredFields": ["categories"],
    "categoryEntry": {
      "requiredFields": ["id", "stub", "hash"]
    }
  },

  "tag": {
    "requiredFields": ["id", "name", "stub", "createdAt"]
  },

  "tagIndex": {
    "requiredFields": ["tags"],
    "tagEntry": {
      "requiredFields": ["id", "stub", "hash"]
    }
  },

  "post": {
    "requiredFields": ["id", "content", "stub", "createdAt", "updatedAt"],
    "optionalFields": ["title", "categoryId", "tagIds", "embed"],
    "embed": {
      "requiredFields": ["type", "position"],
      "optionalFields": ["url", "title", "description", "imageUrl", "imageFilename", "images"],
      "validTypes": ["YouTube", "Link", "Image"],
      "validPositions": ["above", "below"]
    }
  },

  "postIndex": {
    "requiredFields": ["posts"],
    "postEntry": {
      "requiredFields": ["id", "stub", "hash", "modified"]
    }
  },

  "draftIndex": {
    "requiredFields": ["drafts"],
    "draftEntry": {
      "requiredFields": ["id", "stub", "hash", "modified"]
    }
  },

  "sidebarObject": {
    "requiredFields": ["id", "type", "title", "order"],
    "optionalFields": ["content", "links"],
    "validTypes": ["text", "linkList"],
    "link": {
      "requiredFields": ["title", "url", "order"]
    }
  },

  "sidebarIndex": {
    "requiredFields": ["sidebar"],
    "objectEntry": {
      "requiredFields": ["id", "hash"]
    }
  },

  "staticFilesIndex": {
    "requiredFields": ["files"],
    "fileEntry": {
      "requiredFields": ["filename", "mimeType", "hash"],
      "optionalFields": ["specialFileType"]
    }
  },

  "expectedFiles": {
    "alwaysPresent": [
      "manifest.json",
      "blog.json",
      "categories/index.json",
      "tags/index.json",
      "posts/index.json",
      "sidebar/index.json",
      "static-files/index.json",
      "embed-images/index.json"
    ],
    "conditionallyPresent": {
      "drafts/index.json.enc": "when hasDrafts is true",
      "themes/{id}.json": "when custom theme is set"
    },
    "perEntity": {
      "categories/{id}.json": "one per category",
      "tags/{id}.json": "one per tag",
      "posts/{id}.json": "one per published post",
      "drafts/{id}.json.enc": "one per draft (encrypted)",
      "sidebar/{id}.json": "one per sidebar object"
    }
  },

  "testAssertions": [
    {
      "name": "manifest-has-correct-file-count",
      "description": "Manifest files object should have entries for all generated files"
    },
    {
      "name": "all-hashes-are-sha256",
      "description": "All hash values should be 64-character hex strings (SHA-256)"
    },
    {
      "name": "dates-are-iso8601",
      "description": "All date fields should be valid ISO 8601 format"
    },
    {
      "name": "ids-are-consistent",
      "description": "Entity IDs should be consistent across index and individual files"
    },
    {
      "name": "category-references-valid",
      "description": "Post categoryId should reference existing category"
    },
    {
      "name": "tag-references-valid",
      "description": "Post tagIds should reference existing tags"
    },
    {
      "name": "embed-images-indexed",
      "description": "Image embed filenames should appear in embed-images index"
    },
    {
      "name": "encrypted-files-have-iv",
      "description": "Encrypted file entries in manifest should have iv field"
    }
  ]
}
